<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="theme-color" content="#0f1117">
<meta name="apple-mobile-web-app-capable" content="yes">

<title>Staff Attendance Manager</title>
<link rel="icon" type="image/x-icon" href="/images-favicon.ico">

<link rel="stylesheet" href="/css/style.css">

</head>
<body>

<div class="topbar">
  <div class="topbar-logo">Staff <span>Attendance</span> Manager</div>
  <div class="topbar-right">
  <div class="server-status">
  <div id="serverDot" class="status-dot"></div>
  <span id="serverLabel">Checking...</span>
</div>


  <div id="currentDateDisplay"></div>

  <button class="btn btn-outline" onclick="openPasswordModal()">
    Reset Password
  </button>

  <button class="btn btn-danger" onclick="logout()">
    Logout
  </button>
</div>

</div>

<div class="tabs">
  <button class="tab-btn active" onclick="switchTab('dashboard')">Dashboard</button>
  <button class="tab-btn" onclick="switchTab('mark')">Mark Attendance</button>
  <button class="tab-btn" onclick="switchTab('staff')">Staff</button>
  <button class="tab-btn" onclick="switchTab('holiday')">Holiday</button>
  <button class="tab-btn" onclick="switchTab('report')">Monthly Report</button>
  <button class="tab-btn" onclick="switchTab('overview')">Monthly Overview</button>

</div>

<div class="main">

  <div class="page active" id="page-dashboard">
    <div class="section-header">
      <div class="section-title">Today's <span>Overview</span></div>
      <div style="font-size:13px; color:var(--text-muted); background:var(--card); padding:6px 12px; border-radius:20px; border:1px solid var(--card-border);">
        <span id="liveClock">--:--</span>
      </div>
    </div>

    <div class="stats-row">
      <div class="stat-card" style="--accent-color: var(--green)">
        <div class="stat-header">
          <span class="stat-label">PRESENT</span>
          <div class="stat-icon" style="color:var(--green); background:rgba(52,211,153,0.1)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg>
          </div>
        </div>
        <div class="stat-value" id="stat-present">0</div>
      </div>

      <div class="stat-card" style="--accent-color: var(--red)">
        <div class="stat-header">
          <span class="stat-label">ABSENT</span>
          <div class="stat-icon" style="color:var(--red); background:rgba(248,113,113,0.1)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
          </div>
        </div>
        <div class="stat-value" id="stat-absent">0</div>
      </div>

      <div class="stat-card" style="--accent-color: var(--amber)">
        <div class="stat-header">
          <span class="stat-label">HALF DAY</span>
          <div class="stat-icon" style="color:var(--amber); background:rgba(251,191,36,0.1)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg>
          </div>
        </div>
        <div class="stat-value" id="stat-halfday">0</div>
      </div>

      <div class="stat-card" style="--accent-color: var(--text-muted)">
        <div class="stat-header">
          <span class="stat-label">UNMARKED</span>
          <div class="stat-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
          </div>
        </div>
        <div class="stat-value" id="stat-unmarked">0</div>
      </div>
    </div>

    <div class="dashboard-grid">
      <div class="card" style="min-height:360px; display:flex; flex-direction:column; justify-content:center; align-items:center; position:relative;">
        <div style="position:absolute; top:20px; left:20px; font-weight:700; font-size:16px;">Analytics</div>
        <div style="width:240px; height:240px; position:relative;">
          <canvas id="pieChart"></canvas>
          <div style="position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; pointer-events:none;">
            <div style="font-size:32px; font-weight:800; color:var(--text);" id="totalStaffCount">0</div>
            <div style="font-size:12px; color:var(--text-muted); text-transform:uppercase; font-weight:600;">Total Staff</div>
          </div>
        </div>
      </div>

      <div class="card" style="height:100%; min-height:360px;">
        <div style="font-weight:700; font-size:16px; margin-bottom:16px; display:flex; justify-content:space-between; align-items:center;">
          <span>Staff Status</span>
          <span style="font-size:11px; font-weight:500; color:var(--text-muted); background:rgba(255,255,255,0.05); padding:4px 8px; border-radius:6px;">Live Today</span>
        </div>
        <div id="dashStaffList" style="max-height:300px; overflow-y:auto; padding-right:4px;"></div>
      </div>
    </div>
  </div>

  <div class="page" id="page-mark">
    <div class="section-header">
      <div class="section-title">Mark <span>Attendance</span></div>
    </div>
    <div class="card" style="margin-bottom:18px;">
      <div class="form-row">
        <div class="form-group" style="max-width:200px;"><label>Select Date</label><input type="date" id="markDate" onchange="renderMarkPage()"/></div>
        <div class="form-group" style="max-width:220px;"><label>Filter Department</label><select id="markDeptFilter" onchange="renderMarkPage()"><option value="All">All Departments</option></select></div>
        <button class="btn btn-green" onclick="markAllPresent()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 13l4 4L19 7"/></svg> Mark All Present
        </button>
      </div>
    </div>
    <div class="legend">
      <div class="legend-item"><div class="legend-dot" style="background:var(--green)"></div> Present</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--red)"></div> Absent</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--amber)"></div> Half Day</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--purple)"></div> Holiday</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--gray-status)"></div> Weekend</div>
    </div>
    <div id="attGrid" class="att-grid"></div>
  </div>

  <div class="page" id="page-staff">
    <div class="section-header">
      <div class="section-title">Manage <span>Staff</span></div>
      <button class="btn btn-primary" onclick="openAddStaff()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg> Add Staff
      </button>
    </div>
    <div class="card">
      <div class="form-row" style="margin-bottom:16px;">
        <div class="form-group"><label>Search</label><input type="text" id="staffSearch" placeholder="Search by name or ID…" oninput="renderStaffTable()"/></div>
        <div class="form-group" style="max-width:200px;"><label>Department</label><select id="staffDeptFilter" onchange="renderStaffTable()"><option value="All">All</option></select></div>
      </div>
      <div class="table-wrap">
        <table><thead><tr><th>#</th><th>Name</th><th>Staff ID</th><th>Department</th><th>Position</th><th style="text-align:right;">Actions</th></tr></thead>
        <tbody id="staffTableBody"></tbody></table>
        <div id="staffEmpty" style="text-align:center;padding:40px;color:var(--text-muted);font-size:14px;"></div>
      </div>
    </div>
  </div>

  <div class="page" id="page-holiday">
  <div class="section-header">
    <div class="section-title">Holiday <span>Manager</span></div>
  </div>

  <div class="card" style="margin-bottom:20px;">
    <div class="form-row">
      <div class="form-group" style="max-width:200px;">
        <label>Date</label>
        <input type="date" id="holidayDate">
      </div>

      <div class="form-group">
        <label>Occasion Name</label>
        <input type="text" id="holidayName" placeholder="e.g. Diwali">
      </div>

      <button class="btn btn-primary" onclick="addHoliday()">
        Add Holiday
      </button>
    </div>
  </div>

  <div class="card">
    <div id="holidayList"></div>
  </div>
</div>


  <div class="page" id="page-report">
    <div class="section-header">
      <div class="section-title">Monthly <span>Report</span></div>
    </div>
    <div class="card" style="margin-bottom:18px;">
      <div class="form-row">
        <div class="form-group" style="max-width:170px;"><label>Month</label><select id="reportMonth" onchange="renderReport()"></select></div>
        <div class="form-group" style="max-width:130px;"><label>Year</label><select id="reportYear" onchange="renderReport()"></select></div>
        <div class="form-group" style="max-width:210px;"><label>Department</label><select id="reportDeptFilter" onchange="renderReport()"><option value="All">All Departments</option></select></div>
        <div class="download-row">
          <button class="btn btn-primary" onclick="downloadExcel()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19V5M5 12l7 7 7-7"/></svg> Excel
          </button>
          <button class="btn btn-outline" onclick="downloadPDF()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19V5M5 12l7 7 7-7"/></svg> PDF
          </button>
        </div>
      </div>
    </div>
    <div class="stats-row" id="reportStats"></div>
    <div class="legend">
      <div class="legend-item"><div class="legend-dot" style="background:var(--green)"></div> P – Present</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--red)"></div> A – Absent</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--amber)"></div> H – Half Day</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--purple)"></div> Ho – Holiday</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--gray-status)"></div> W – Weekend</div>
    </div>
    <div class="card">
      <div class="month-table-wrap">
        <table class="month-table"><thead id="reportThead"></thead><tbody id="reportTbody"></tbody></table>
      </div>
    </div>
  </div>
  <div class="page" id="page-overview">

  <div class="section-header">
    <div class="section-title">
      Monthly <span>Overview</span>
    </div>
  </div>

  <!-- FILTERS -->
  <div class="card" style="margin-bottom:18px;">
    <div class="form-row">

      <div class="form-group" style="max-width:170px;">
        <label>Month</label>
        <select id="overviewMonth" onchange="renderMonthlyOverview()"></select>
      </div>

      <div class="form-group" style="max-width:130px;">
        <label>Year</label>
        <select id="overviewYear" onchange="renderMonthlyOverview()"></select>
      </div>

      <div class="form-group" style="max-width:210px;">
        <label>Department</label>
        <select id="overviewDeptFilter" onchange="renderMonthlyOverview()">
          <option value="All">All Departments</option>
        </select>
      </div>

      <div class="download-row">
        <button class="btn btn-primary" onclick="downloadOverviewExcel()">
          Excel
        </button>
        <button class="btn btn-outline" onclick="downloadOverviewPDF()">
          PDF
        </button>
      </div>

    </div>
  </div>

  <!-- CONTENT -->
  <div id="monthlyOverviewContainer">

    <div class="card" style="margin-bottom:20px;">

  <div onclick="toggleOverviewGraph()"
       style="
         cursor:pointer;
         display:flex;
         justify-content:space-between;
         align-items:center;
         font-weight:600;
         font-size:16px;
       ">

    <span>Monthly Graph</span>
    <span id="overviewGraphIcon">▶</span>

  </div>

  <div id="overviewGraphContent" style="margin-top:15px; display:none;">

    <div class="stats-row" id="overviewStats"></div>

    <div class="overview-chart-wrapper">
      <canvas id="overviewChart"></canvas>
    </div>

  </div>

</div>


    <div id="overviewTableSection">
      <div id="overviewTitle"
     style="
       margin: 20px 0 10px 0;
       font-size: 18px;
       font-weight: 700;
       text-align: center;
       letter-spacing: 0.5px;
     ">
</div>
      <div class="card">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Staff ID</th>
                <th>Present</th>
                <th>Absent</th>
                <th>Half Day</th>
                <th>Attendance %</th>
              </tr>
            </thead>
            <tbody id="overviewTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

</div>


<div class="toast" id="toast"></div>

<div class="modal-overlay" id="passwordModal">
  <div class="modal">
    <h3>Reset Password</h3>

    <div class="form-group">
      <label>Current Password</label>
      <input type="password" id="currentPassword">
    </div>

    <div class="form-group">
      <label>New Password</label>
      <input type="password" id="newPassword">
    </div>

    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closePasswordModal()">Cancel</button>
      <button class="btn btn-primary" onclick="resetPassword()">Update</button>
    </div>
  </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
<script src="/js/app.js"></script>

</body>
</html>