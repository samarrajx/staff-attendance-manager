<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Staff Attendance Manager</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/shadows.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="icon" href="/images-favicon.ico" type="image/x-icon">

</head>

<body>

    <!-- ─── MOBILE OVERLAY ─── -->
    <div class="mobile-overlay" id="mobileOverlay" onclick="toggleSidebar()"></div>

    <!-- ─── SIDEBAR ─── -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                ATTENDANCE
            </div>
        </div>

        <nav class="nav-links">
            <a class="nav-item active" onclick="switchTab('dashboard')" id="nav-dashboard">
                <i class="ri-dashboard-3-line"></i>
                Dashboard
            </a>
            <a class="nav-item" onclick="switchTab('mark')" id="nav-mark">
                <i class="ri-checkbox-circle-line"></i>
                Mark Attendance
            </a>
            <a class="nav-item" onclick="switchTab('staff')" id="nav-staff">
                <i class="ri-group-line"></i>
                Staff List
            </a>
            <a class="nav-item" onclick="switchTab('holiday')" id="nav-holiday">
                <i class="ri-calendar-event-line"></i>
                Holidays
            </a>
            <a class="nav-item" onclick="switchTab('report')" id="nav-report">
                <i class="ri-file-chart-line"></i>
                Monthly Report
            </a>
            <a class="nav-item" onclick="switchTab('overview')" id="nav-overview">
                <i class="ri-pie-chart-2-line"></i>
                Overview
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-mini">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <div class="user-name" id="userName">User</div>
                    <div class="user-role" id="userRole">Employee</div>
                </div>
                <button onclick="logout()" style="background:none;border:none;color:var(--red);cursor:pointer;"
                    title="Logout">
                    <i class="ri-logout-box-r-line" style="font-size:18px;"></i>
                </button>
            </div>
        </div>
    </aside>

    <!-- ─── MAIN CONTENT ─── -->
    <main class="main-content">

        <header class="topbar">
            <div class="topbar-left">
                <button class="hamburger" onclick="toggleSidebar()">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <div class="page-title" id="pageTitle">Dashboard</div>
            </div>

            <div class="topbar-right">
                <div class="status-badge">
                    <div class="live-dot" id="serverDot"></div>
                    <span id="serverLabel">Checking...</span>
                </div>
                <button class="btn btn-outline" onclick="toggleTheme()" style="padding:8px 12px; font-size:16px;">
                    <i class="ri-moon-line" id="themeIcon"></i>
                </button>

                <button class="btn btn-outline" onclick="openPasswordModal()" style="padding:8px 12px; font-size:12px;">
                    <i class="ri-key-2-line"></i> Key
                </button>
            </div>
        </header>

        <div class="content-area">

            <!-- DASHBOARD -->
            <div class="page active" id="page-dashboard">
                <div class="stats-row">
                    <div class="stat-card shadow-green" style="--accent-color:var(--green)">
                        <div class="stat-header"><span class="stat-label">Present</span>
                            <div class="stat-icon"><i class="ri-user-check-line"></i></div>
                        </div>
                        <div class="stat-value" id="stat-present">0</div>
                    </div>
                    <div class="stat-card shadow-red" style="--accent-color:var(--red)">
                        <div class="stat-header"><span class="stat-label">Absent</span>
                            <div class="stat-icon"><i class="ri-user-unfollow-line"></i></div>
                        </div>
                        <div class="stat-value" id="stat-absent">0</div>
                    </div>
                    <div class="stat-card shadow-amber" style="--accent-color:var(--amber)">
                        <div class="stat-header"><span class="stat-label">Half Day</span>
                            <div class="stat-icon"><i class="ri-time-line"></i></div>
                        </div>
                        <div class="stat-value" id="stat-halfday">0</div>
                    </div>
                    <div class="stat-card" style="--accent-color:var(--text-muted)">
                        <div class="stat-header"><span class="stat-label">Unmarked</span>
                            <div class="stat-icon"><i class="ri-question-mark"></i></div>
                        </div>
                        <div class="stat-value" id="stat-unmarked">0</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card"
                        style="height:340px; display:flex; flex-direction:column; align-items:center; justify-content:center;">
                        <h4 style="margin-bottom:20px;">Attendance Distribution</h4>
                        <div style="width:200px; height:200px; position:relative;">
                            <canvas id="pieChart"></canvas>
                            <div
                                style="position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; pointer-events:none;">
                                <div style="font-size:24px; font-weight:800; color:var(--text);" id="totalStaffCount">0
                                </div>
                                <div
                                    style="font-size:10px; color:var(--text-muted); text-transform:uppercase; font-weight:600;">
                                    Total Staff</div>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="height:100%; min-height:400px; display:flex; flex-direction:column;">
                        <div style="margin-bottom:16px; font-weight:700; display:flex; justify-content:space-between;">
                            <span>Live Staff Status</span>
                            <span
                                style="font-size:11px; background:rgba(255,255,255,0.05); padding:4px 8px; border-radius:6px; color:var(--text-muted);"
                                id="liveClock">--:--</span>
                        </div>
                        <div id="dashStaffList" style="flex:1; overflow-y:auto; padding-right:6px;"></div>
                    </div>
                </div>
            </div>

            <!-- MARK ATTENDANCE -->
            <div class="page" id="page-mark">
                <div class="card shadow-accent" style="margin-bottom:20px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Date</label>
                            <div class="input-group">
                                <i class="ri-calendar-line input-icon"></i>
                                <input type="date" id="markDate" onchange="renderMarkPage()">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Department</label>
                            <div class="input-group">
                                <i class="ri-building-line input-icon"></i>
                                <select id="markDeptFilter" onchange="renderMarkPage()">
                                    <option value="All">All Departments</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="markAllPresent()" style="margin-bottom:2px;">
                            <i class="ri-check-double-line"></i> Mark All Present
                        </button>
                    </div>
                </div>
                <div id="attGrid" class="att-grid"></div>
            </div>

            <!-- STAFF -->
            <div class="page" id="page-staff">
                <div class="card shadow-accent">
                    <div class="form-row" style="justify-content:space-between; align-items:flex-end;">
                        <div style="display:flex; gap:16px; flex:1; flex-wrap:wrap;">
                            <div class="form-group">
                                <label>Search Staff</label>
                                <div class="input-group">
                                    <i class="ri-search-line input-icon"></i>
                                    <input type="text" id="staffSearch" placeholder="Name or ID..."
                                        oninput="renderStaffTable()">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Filter Dept</label>
                                <div class="input-group">
                                    <i class="ri-filter-3-line input-icon"></i>
                                    <select id="staffDeptFilter" onchange="renderStaffTable()">
                                        <option value="All">All</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="openAddStaff()">
                            <i class="ri-user-add-line"></i> Add Staff
                        </button>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Staff Member</th>
                                    <th>ID</th>
                                    <th>Dept</th>
                                    <th>Position</th>
                                    <th style="text-align:right;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="staffTableBody"></tbody>
                        </table>
                        <div id="staffEmpty" style="text-align:center; padding:40px; color:var(--text-muted);"></div>
                    </div>
                </div>
            </div>

            <!-- HOLIDAYS -->
            <div class="page" id="page-holiday">
                <div class="card shadow-purple" style="margin-bottom:20px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Holiday Date</label>
                            <div class="input-group">
                                <i class="ri-calendar-line input-icon"></i>
                                <input type="date" id="holidayDate">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Occasion Name</label>
                            <div class="input-group">
                                <i class="ri-bookmark-line input-icon"></i>
                                <input type="text" id="holidayName" placeholder="e.g. Diwali">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addHoliday()">
                            <i class="ri-add-line"></i> Add Holiday
                        </button>
                    </div>
                </div>
                <div class="card">
                    <div id="holidayList"
                        style="display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:12px;">
                    </div>
                </div>
            </div>

            <!-- REPORT -->
            <div class="page" id="page-report">
                <div class="card shadow-accent" style="margin-bottom:20px;">
                    <div class="form-row">
                        <div class="form-group" style="max-width:140px;">
                            <label>Month</label>
                            <div class="input-group">
                                <i class="ri-calendar-line input-icon"></i>
                                <select id="reportMonth" onchange="renderReport()"></select>
                            </div>
                        </div>
                        <div class="form-group" style="max-width:120px;">
                            <label>Year</label>
                            <div class="input-group">
                                <i class="ri-history-line input-icon"></i>
                                <select id="reportYear" onchange="renderReport()"></select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Department</label>
                            <div class="input-group">
                                <i class="ri-building-line input-icon"></i>
                                <select id="reportDeptFilter" onchange="renderReport()">
                                    <option value="All">All</option>
                                </select>
                            </div>
                        </div>
                        <div class="download-buttons">
                            <button class="btn btn-green" onclick="downloadExcel()">
                                <i class="ri-file-excel-2-line"></i> Excel
                            </button>
                            <button class="btn btn-outline" onclick="downloadPDF()">
                                <i class="ri-file-pdf-line"></i> PDF
                            </button>
                        </div>
                    </div>
                </div>
                <div class="stats-row" id="reportStats"></div>
                <div class="card shadow-accent" id="reportTableCard">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h4 style="margin:0; color:var(--accent)" id="reportTitle">Attendance Log</h4>
                        <span style="font-size:12px; color:var(--text-muted);" id="reportSubtitle"></span>
                    </div>
                    <div class="table-wrap">
                        <table class="month-table">
                            <thead id="reportThead"></thead>
                            <tbody id="reportTbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- OVERVIEW -->
            <div class="page" id="page-overview">
                <div class="card shadow-accent" style="margin-bottom:20px;">
                    <div class="form-row">
                        <div class="form-group" style="max-width:140px;">
                            <label>Month</label>
                            <div class="input-group">
                                <i class="ri-calendar-line input-icon"></i>
                                <select id="overviewMonth" onchange="renderMonthlyOverview()"></select>
                            </div>
                        </div>
                        <div class="form-group" style="max-width:120px;">
                            <label>Year</label>
                            <div class="input-group">
                                <i class="ri-history-line input-icon"></i>
                                <select id="overviewYear" onchange="renderMonthlyOverview()"></select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Department</label>
                            <div class="input-group">
                                <i class="ri-building-line input-icon"></i>
                                <select id="overviewDeptFilter" onchange="renderMonthlyOverview()">
                                    <option value="All">All</option>
                                </select>
                            </div>
                        </div>
                        <div class="download-buttons">
                            <button class="btn btn-green" onclick="downloadOverviewExcel()">
                                <i class="ri-file-excel-2-line"></i> Excel
                            </button>
                            <button class="btn btn-outline" onclick="downloadOverviewPDF()">
                                <i class="ri-file-pdf-line"></i> PDF
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card" style="margin-bottom:20px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                        <h4 style="margin:0;">Attendance Distribution (Stacked)</h4>
                        <button class="btn btn-outline" onclick="toggleOverviewChart()">Expand</button>
                    </div>
                    <div id="overviewChartContainer" style="height:0; overflow:hidden; transition:all 0.3s ease;">
                        <canvas id="overviewStackedChart"></canvas>
                    </div>
                </div>

                <div class="card shadow-accent" id="overviewTableCard">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h4 style="margin:0; color:var(--accent)" id="overviewTitle">Monthly Overview</h4>
                        <span style="font-size:12px; color:var(--text-muted);" id="overviewSubtitle"></span>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Name</th>
                                    <th>ID</th>
                                    <th>Present</th>
                                    <th>Absent</th>
                                    <th>Half Day</th>
                                    <th>Att %</th>
                                </tr>
                            </thead>
                            <tbody id="overviewTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div> <!-- End content-area -->
    </main>

    <!-- ─── MODALS ─── -->
    <div class="modal-overlay" id="staffModal">
        <div class="modal">
            <h3 id="staffModalTitle">Add Staff</h3>
            <input type="hidden" id="editStaffId">
            <div class="form-group" style="margin-bottom:12px;"><label>Full Name</label><input type="text"
                    id="staffName"></div>
            <div class="form-group" style="margin-bottom:12px;"><label>Staff ID</label><input type="text" id="staffId">
            </div>
            <div class="form-group" style="margin-bottom:12px;"><label>Department</label><input type="text"
                    id="staffDept"></div>
            <div class="form-group" style="margin-bottom:12px;"><label>Position</label><input type="text"
                    id="staffPosition"></div>
            <div class="form-group" style="margin-bottom:20px;">
                <label>System Role</label>
                <select id="staffRole">
                    <option value="employee">Employee (View Only)</option>
                    <option value="manager">Manager (Can Mark Attendance)</option>
                    <option value="admin">Admin (Full Access)</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closeStaffModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveStaff()">Save Staff</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="passwordModal">
        <div class="modal">
            <h3>Reset Password</h3>
            <div class="form-group" style="margin-bottom:12px;"><label>Current Password</label><input type="password"
                    id="currentPassword"></div>
            <div class="form-group" style="margin-bottom:20px;"><label>New Password</label><input type="password"
                    id="newPassword"></div>
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closePasswordModal()">Cancel</button>
                <button class="btn btn-primary" onclick="resetPassword()">Update</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">Noctification message</div>

    <!-- ─── SCRIPTS ─── -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
    <script src="/js/app.js"></script>

</body>

</html>